<!doctype html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bug Busters üêû</title>
<link rel="stylesheet" href="../../assets/styles.css" />
<style>
  .hud { display:flex; justify-content:space-between; gap:16px; margin:8px 0 12px; }
  .playfield {
    position: relative;
    width: min(640px, 90vw);
    height: min(420px, 63vw);
    margin: 0 auto;
    border: 2px dashed #333;
    background:
      repeating-linear-gradient(135deg,#0000 0 10px,#0001 10px 20px);
  }
  #bug{
    position:absolute; inset:auto auto 50% 50%;
    transform: translate(-50%,-50%);
    width:56px; height:56px; border-radius:50%;
    display:grid; place-items:center;
    font-size:28px; line-height:1;
    background:#ff6b6b; color:#111; border:2px solid #b33;
    cursor:pointer; box-shadow:0 4px 0 #b33; user-select:none;
  }
  #bug:active{ transform: translate(-50%,-50%) translateY(2px); box-shadow:0 2px 0 #b33; }
  .hint{ max-width:640px; margin:12px auto; color:var(--muted); font-size:14px; }
  .back { display:inline-block; margin:12px 0; }
</style>

<body>
  <div class="container">
    <a class="btn back" href="../../">‚Üê Games</a>
    <h1>Bug Busters üêû</h1>

    <div class="hud">
      <div>Time: <span id="time">15.0s</span></div>
      <div>Score: <span id="score">0</span></div>
    </div>

    <div id="playfield" class="playfield" aria-label="Play area"></div>

    <p class="hint">Tap the bug fast! üêû‚ö°</p>
  </div>

<script>
  // üëâ –£–∫–∞–∂–∏ –±—ç–∫–µ–Ω–¥ (Render)
  const API_BASE = 'https://kids-games-backend.onrender.com';

  // DOM
  const field = document.getElementById('playfield');
  const timeEl = document.getElementById('time');
  const scoreEl = document.getElementById('score');

  // –°–æ—Å—Ç–æ—è–Ω–∏–µ
  let score = 0;
  let endAt = Date.now() + 15000; // 15s
  let tickId = 0;

  // –°–æ–∑–¥–∞—ë–º –∫–Ω–æ–ø–∫—É-–∂—É–∫–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ
  const bug = document.createElement('button');
  bug.id = 'bug';
  bug.type = 'button';
  bug.setAttribute('aria-label','Bug');
  bug.textContent = 'üêû';
  field.appendChild(bug);

  // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ —É –ø–æ–ª—è –µ—Å—Ç—å —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤
  function bounds(){
    const r = field.getBoundingClientRect();
    return { w: r.width, h: r.height };
  }

  function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

  function moveBug() {
    const { w, h } = bounds();
    const pad = 8 + 56; // —á—É—Ç—å –±–æ–ª—å—à–µ —Ä–∞–¥–∏—É—Å–∞
    const x = Math.random() * (w - pad*2) + pad;
    const y = Math.random() * (h - pad*2) + pad;
    bug.style.left = x + 'px';
    bug.style.top  = y + 'px';
  }

  function updateTimer(){
    const ms = clamp(endAt - Date.now(), 0, 15000);
    timeEl.textContent = (ms/1000).toFixed(1) + 's';
    if (ms <= 0){
      gameOver();
      return;
    }
    tickId = requestAnimationFrame(updateTimer);
  }

  function gameOver(){
    cancelAnimationFrame(tickId);
    bug.disabled = true;
    // –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞ Pages, –Ω–æ –±—ç–∫–µ–Ω–¥ –µ—Å—Ç—å ‚Äî –º–æ–∂–µ–º —Å–ª–∞—Ç—å:
    try {
      fetch(API_BASE + '/scores', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ name:'Guest', score })
      }).catch(()=>{});
    } catch(_){}
  }

  bug.addEventListener('click', () => {
    score++;
    scoreEl.textContent = score;
    moveBug();
  });

  // –°—Ç–∞—Ä—Ç
  moveBug();
  updateTimer();

  // –ü–µ—Ä–µ—Å—á—ë—Ç –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ —Ä–µ—Å–∞–π–∑–µ, —á—Ç–æ–±—ã –Ω–µ —É–ª–µ—Ç–∞–ª –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã
  addEventListener('resize', () => moveBug(), { passive: true });
</script>
</body>
</html>
